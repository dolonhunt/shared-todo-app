<FULL CODE INSERTED HERE BY GPT, OMITTED FOR BREVITY>